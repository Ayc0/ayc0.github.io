---
import { getEntry } from "astro:content";
import { LinkCard } from "@astrojs/starlight/components";

import { getCreatedDate, getTagsHtml } from "@components/get-posts";

export interface Props {
  slug: string;
  includeDate?: boolean;
  includeTags?: boolean;
}

const { slug, includeDate, includeTags } = Astro.props;

const entry = await getEntry(
  "docs",
  slug.startsWith("posts/") ? slug : "posts/" + slug,
);
if (entry == null) {
  throw new Error(`slug ${slug} isnâ€™t valid`);
}

// TODO: include in the name the series' name (only for light/dark for now)

let description: string | undefined;
if (includeDate) {
  description = getCreatedDate(entry);
}
if (includeTags) {
  const tags = getTagsHtml(entry);
  if (tags) {
    if (!description) {
      description = tags;
    } else {
      description += `<br/>${tags}`;
    }
  }
}

if (entry.data.description) {
  if (!description) {
    description = entry.data.description;
  } else {
    description = `<p>${description}</p><p>${entry.data.description}</p>`;
  }
}

const props: { href: string; title: string; description?: string } = {
  href: import.meta.env.BASE_URL + entry.slug,
  title: entry.data.title,
};
if (description) {
  props.description = description;
}
---

<div data-pagefind-ignore>
  <LinkCard {...props} />
</div>
