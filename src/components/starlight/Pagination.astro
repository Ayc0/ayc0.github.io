---
import Default from "@astrojs/starlight/components/Pagination.astro";

import {
  getSeriesData,
  getPublishablePostsMatchingSeries,
} from "@components/get-posts";

const thisSeriesData = getSeriesData(Astro.locals.starlightRoute.entry);

Astro.locals.starlightRoute.pagination.prev = undefined;
Astro.locals.starlightRoute.pagination.next = undefined;
if (thisSeriesData) {
  const postsInSameSeries = await getPublishablePostsMatchingSeries(
    thisSeriesData.name,
  );

  const indexOfCurrentPost = postsInSameSeries.findIndex(
    (post) => post.id === Astro.locals.starlightRoute.id,
  );

  if (indexOfCurrentPost !== 0) {
    Astro.locals.starlightRoute.pagination.prev = {
      type: "link",
      label: postsInSameSeries[indexOfCurrentPost - 1]!.data.title,
      href: "/" + postsInSameSeries[indexOfCurrentPost - 1]!.slug,
      badge: undefined,
      isCurrent: false,
      attrs: {},
    };
  }

  if (indexOfCurrentPost !== postsInSameSeries.length - 1) {
    Astro.locals.starlightRoute.pagination.next = {
      type: "link",
      label: postsInSameSeries[indexOfCurrentPost + 1]!.data.title,
      href: "/" + postsInSameSeries[indexOfCurrentPost + 1]!.slug,
      badge: undefined,
      isCurrent: false,
      attrs: {},
    };
  }
}
---

<Default />
