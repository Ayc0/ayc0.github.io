var F={exports:{}},Q;function at(){return Q||(Q=1,function(_,b){(function(M,A){_.exports=A()})(self,function(){return(()=>{var M={132:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.bezkrovnySsim=void 0;var i=c(490),v=c(971);function m(g,d,u){var h=g.data,t=d.data,r=u.bitDepth,a=u.k1,n=u.k2,w=Math.pow(2,r)-1,s=Math.pow(a*w,2),l=Math.pow(n*w,2),o=i.average(h),f=i.average(t),y=i.variance(h,o),E=i.variance(t,f);return(2*o*f+s)*(2*i.covariance(h,t,o,f)+l)/((Math.pow(o,2)+Math.pow(f,2)+s)*(y+E+l))}e.bezkrovnySsim=function(g,d,u){for(var h=u.windowSize,t=Math.ceil(g.width/h),r=Math.ceil(g.height/h),a=new Array(t*r),n=0,w=0;w<g.height;w+=h)for(var s=0;s<g.width;s+=h){var l=Math.min(h,g.width-s),o=Math.min(h,g.height-w),f=v.sub(g,s,o,w,l),y=v.sub(d,s,o,w,l);a[n++]=m(f,y,u)}return{data:a,width:t,height:r}}},63:(p,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.defaults=void 0,e.defaults={windowSize:11,k1:.01,k2:.03,bitDepth:8,downsample:"original",ssim:"weber",maxSize:256,rgb2grayVersion:"integer"}},441:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.downsample=void 0;var i=c(490),v=c(971);function m(g,d,u){var h=v.imfilter(g,d,"symmetric","same");return v.skip2d(h,[0,u,h.height],[0,u,h.width])}e.downsample=function(g,d){return d.downsample==="original"?function(u,h,t){t===void 0&&(t=256);var r=Math.min(u.width,h.height)/t,a=Math.round(r);if(a>1){var n=v.ones(a);u=m(u,n=i.divide2d(n,i.sum2d(n)),a),h=m(h,n,a)}return[u,h]}(g[0],g[1],d.maxSize):g}},607:function(p,e,c){var i=this&&this.__assign||function(){return(i=Object.assign||function(s){for(var l,o=1,f=arguments.length;o<f;o++)for(var y in l=arguments[o])Object.prototype.hasOwnProperty.call(l,y)&&(s[y]=l[y]);return s}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ssim=e.getOptions=void 0;var v=c(971),m=c(490),g=c(773),d=c(595),u=c(132),h=c(441),t=c(63),r=c(535),a={fast:g.ssim,original:d.originalSsim,bezkrovny:u.bezkrovnySsim,weber:r.weberSsim};function n(s){var l=i(i({},t.defaults),s);return function(o){if(Object.keys(o).forEach(function(f){if(!(f in t.defaults))throw new Error('"'+f+'" is not a valid option')}),"k1"in o&&(typeof o.k1!="number"||o.k1<0))throw new Error("Invalid k1 value. Default is "+t.defaults.k1);if("k2"in o&&(typeof o.k2!="number"||o.k2<0))throw new Error("Invalid k2 value. Default is "+t.defaults.k2);if(!(o.ssim in a))throw new Error("Invalid ssim option (use: "+Object.keys(a).join(", ")+")")}(l),l}function w(s,l,o){var f,y,E,O,x=new Date().getTime(),I=function(j){var P=j[0],S=j[1],k=j[2];return a[k.ssim](P,S,k)}(function(j){var P=j[0],S=j[1],k=j[2],z=h.downsample([P,S],k);return[z[0],z[1],k]}((f=function(j){var P=j[0],S=j[1],k=j[2];if(P.width!==S.width||P.height!==S.height)throw new Error("Image dimensions do not match");return[P,S,k]}([s,l,n(o)]),y=f[0],E=f[1],(O=f[2]).rgb2grayVersion==="original"?[v.rgb2gray(y),v.rgb2gray(E),O]:[v.rgb2grayInteger(y),v.rgb2grayInteger(E),O])));return{mssim:I.mssim!==void 0?I.mssim:m.mean2d(I),ssim_map:I,performance:new Date().getTime()-x}}e.getOptions=n,e.ssim=w,e.default=w},490:(p,e)=>{function c(d){return i(d)/d.length}function i(d){for(var u=0,h=0;h<d.length;h++)u+=d[h];return u}function v(d){for(var u=d.data,h=0,t=0;t<u.length;t++)h+=u[t];return h}function m(d,u){for(var h=d.data,t=d.width,r=d.height,a=new Array(h.length),n=0;n<h.length;n++)a[n]=h[n]+u;return{data:a,width:t,height:r}}function g(d,u){return typeof u=="number"?function(h,t){for(var r=h.data,a=h.width,n=h.height,w=new Array(r.length),s=0;s<r.length;s++)w[s]=r[s]*t;return{data:w,width:a,height:n}}(d,u):function(h,t){for(var r=h.data,a=h.width,n=h.height,w=t.data,s=new Array(r.length),l=0;l<r.length;l++)s[l]=r[l]*w[l];return{data:s,width:a,height:n}}(d,u)}Object.defineProperty(e,"__esModule",{value:!0}),e.covariance=e.variance=e.mean2d=e.square2d=e.multiply2d=e.divide2d=e.subtract2d=e.add2d=e.sum2d=e.floor=e.sum=e.average=void 0,e.average=c,e.sum=i,e.floor=function(d){for(var u=new Array(d.length),h=0;h<d.length;h++)u[h]=Math.floor(d[h]);return u},e.sum2d=v,e.add2d=function(d,u){return typeof u=="number"?m(d,u):function(h,t){for(var r=h.data,a=h.width,n=h.height,w=t.data,s=new Array(r.length),l=0;l<n;l++)for(var o=l*a,f=0;f<a;f++)s[o+f]=r[o+f]+w[o+f];return{data:s,width:a,height:n}}(d,u)},e.subtract2d=function(d,u){return typeof u=="number"?m(d,-u):function(h,t){for(var r=h.data,a=h.width,n=h.height,w=t.data,s=new Array(r.length),l=0;l<n;l++)for(var o=l*a,f=0;f<a;f++)s[o+f]=r[o+f]-w[o+f];return{data:s,width:a,height:n}}(d,u)},e.divide2d=function(d,u){return typeof u=="number"?function(h,t){for(var r=h.data,a=h.width,n=h.height,w=new Array(r.length),s=0;s<r.length;s++)w[s]=r[s]/t;return{data:w,width:a,height:n}}(d,u):function(h,t){for(var r=h.data,a=h.width,n=h.height,w=t.data,s=new Array(r.length),l=0;l<r.length;l++)s[l]=r[l]/w[l];return{data:s,width:a,height:n}}(d,u)},e.multiply2d=g,e.square2d=function(d){return g(d,d)},e.mean2d=function(d){return v(d)/d.data.length},e.variance=function(d,u){u===void 0&&(u=c(d));for(var h=0,t=d.length;t--;)h+=Math.pow(d[t]-u,2);return h/d.length},e.covariance=function(d,u,h,t){h===void 0&&(h=c(d)),t===void 0&&(t=c(u));for(var r=0,a=d.length;a--;)r+=(d[a]-h)*(u[a]-t);return r/d.length}},687:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.conv2=void 0;var i=c(490),v=c(298),m=c(118),g=c(799);function d(a,n,w){var s=a.data,l=a.width,o=a.height;w===void 0&&(w="full");for(var f=l+n.width-1,y=o+n.height-1,E=g.zeros(y,f).data,O=0;O<n.height;O++)for(var x=0;x<n.width;x++){var I=n.data[O*n.width+x];if(I)for(var j=0;j<o;j++)for(var P=0;P<l;P++)E[(j+O)*f+P+x]+=s[j*l+P]*I}return r({data:E,width:f,height:y},w,o,n.height,l,n.width)}function u(a,n,w){var s=n.data,l=n.width,o=n.height;w===void 0&&(w="full");var f=t(a,v.ones(o,1),v.ones(1,l),w);return i.multiply2d(f,s[0])}function h(a){for(var n=a.data,w=n[0],s=1;s<n.length;s++)if(n[s]!==w)return!1;return!0}function t(a,n,w,s){s===void 0&&(s="full");var l=Math.max(n.height,n.width),o=Math.max(w.height,w.width),f=d(a,n,"full");return r(d(f,w,"full"),s,a.height,l,a.width,o)}function r(a,n,w,s,l,o){if(n==="full")return a;if(n==="same"){var f=Math.ceil((a.height-w)/2),y=Math.ceil((a.width-l)/2);return m.sub(a,f,w,y,l)}return m.sub(a,s-1,w-s+1,o-1,l-o+1)}e.conv2=function(){for(var a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];return a[2]&&a[2].data?t.apply(void 0,a):h(a[1])?u.apply(void 0,a):d.apply(void 0,a)}},346:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.filter2=void 0;var i=c(687);e.filter2=function(v,m,g){return g===void 0&&(g="same"),i.conv2(m,function(d){for(var u=d.data,h=d.width,t=d.height,r=new Array(u.length),a=0;a<t;a++)for(var n=0;n<h;n++)r[a*h+n]=u[(t-1-a)*h+h-1-n];return{data:r,width:h,height:t}}(v),g)}},470:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fspecial=void 0;var i=c(490);e.fspecial=function(v,m,g){m===void 0&&(m=3),g===void 0&&(g=1.5);var d=function(h,t){for(var r=h.data,a=h.width,n=h.height,w=new Array(r.length),s=0;s<r.length;s++)w[s]=Math.exp(-r[s]/(2*Math.pow(t,2)));return{data:w,width:a,height:n}}(function(h){for(var t=2*h+1,r=new Array(Math.pow(t,2)),a=0;a<t;a++)for(var n=0;n<t;n++)r[a*t+n]=Math.pow(a-h,2)+Math.pow(n-h,2);return{data:r,width:t,height:t}}(m=(m-1)/2),g),u=i.sum2d(d);return i.divide2d(d,u)}},521:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.imfilter=void 0;var i=c(20),v=c(389),m=c(490),g=c(346);e.imfilter=function(d,u,h,t){return h===void 0&&(h="symmetric"),t===void 0&&(t="same"),d=function(r,a,n,w){if(r=v.padarray(r,m.floor([a/2,n/2]),w),i.mod(a,2)===0&&(r.data=r.data.slice(0,-r.width),r.height--),i.mod(n,2)===0){for(var s=[],l=0;l<r.data.length;l++)(l+1)%r.width!=0&&s.push(r.data[l]);r.data=s,r.width--}return r}(d,u.width,u.height,h),t=function(r){return r==="same"&&(r="valid"),r}(t),g.filter2(u,d,t)}},971:function(p,e,c){var i=this&&this.__createBinding||(Object.create?function(m,g,d,u){u===void 0&&(u=d),Object.defineProperty(m,u,{enumerable:!0,get:function(){return g[d]}})}:function(m,g,d,u){u===void 0&&(u=d),m[u]=g[d]}),v=this&&this.__exportStar||function(m,g){for(var d in m)d==="default"||Object.prototype.hasOwnProperty.call(g,d)||i(g,m,d)};Object.defineProperty(e,"__esModule",{value:!0}),v(c(687),e),v(c(346),e),v(c(470),e),v(c(521),e),v(c(150),e),v(c(298),e),v(c(389),e),v(c(582),e),v(c(439),e),v(c(118),e),v(c(240),e),v(c(799),e)},928:(p,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.numbers=void 0,e.numbers=function(c,i,v){for(var m=i*c,g=new Array(m),d=0;d<m;d++)g[d]=v;return{data:g,width:i,height:c}}},20:(p,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.mod=void 0,e.mod=function(c,i){return c-i*Math.floor(c/i)}},150:(p,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.normpdf=void 0,e.normpdf=function(c,i,v){var m=c.data,g=c.width,d=c.height;i===void 0&&(i=0),v===void 0&&(v=1);for(var u=new Array(m.length),h=0;h<m.length;h++){var t=(m[h]-i)/v;u[h]=Math.exp(-Math.pow(t,2)/2)/(2.5066282746310007*v)}return{data:u,width:g,height:d}}},298:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ones=void 0;var i=c(928);e.ones=function(v,m){return m===void 0&&(m=v),i.numbers(v,m,1)}},389:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.padarray=void 0;var i=c(20);e.padarray=function(v,m,g,d){var u=m[0],h=m[1];return v.height>=u&&v.width>=h?function(t,r){for(var a=r[0],n=r[1],w=t.width+2*n,s=t.height+2*a,l=new Array(w*s),o=-a;o<0;o++){for(var f=-n;f<0;f++)l[(o+a)*w+f+n]=t.data[(Math.abs(o)-1)*t.width+Math.abs(f)-1];for(f=0;f<t.width;f++)l[(o+a)*w+f+n]=t.data[(Math.abs(o)-1)*t.width+f];for(f=t.width;f<t.width+n;f++)l[(o+a)*w+f+n]=t.data[(Math.abs(o)-1)*t.width+2*t.width-f-1]}for(o=0;o<t.height;o++){for(f=-n;f<0;f++)l[(o+a)*w+f+n]=t.data[o*t.width+Math.abs(f)-1];for(f=0;f<t.width;f++)l[(o+a)*w+f+n]=t.data[o*t.width+f];for(f=t.width;f<t.width+n;f++)l[(o+a)*w+f+n]=t.data[o*t.width+2*t.width-f-1]}for(o=t.height;o<t.height+a;o++){for(f=-n;f<0;f++)l[(o+a)*w+f+n]=t.data[(2*t.height-o-1)*t.width+Math.abs(f)-1];for(f=0;f<t.width;f++)l[(o+a)*w+f+n]=t.data[(2*t.height-o-1)*t.width+f];for(f=t.width;f<t.width+n;f++)l[(o+a)*w+f+n]=t.data[(2*t.height-o-1)*t.width+2*t.width-f-1]}return{data:l,width:w,height:s}}(v,[u,h]):function(t,r){for(var a=function(o,f){return{data:o.data.concat(f.data),height:o.height+f.height,width:o.width}}(t,function(o){for(var f=o.data,y=o.width,E=o.height,O=new Array(f.length),x=0;x<E;x++)for(var I=0;I<y;I++)O[x*y+I]=f[(E-1-x)*y+I];return{data:O,width:y,height:E}}(t)),n=t.height+2*r,w=new Array(t.width*n),s=-r;s<t.height+r;s++)for(var l=0;l<t.width;l++)w[(s+r)*t.width+l]=a.data[i.mod(s,a.height)*t.width+l];return{data:w,width:t.width,height:n}}(function(t,r){for(var a=t.width+2*r,n=new Array(a*t.height),w=function(o,f){for(var y=o.width+f.width,E=new Array(o.height*y),O=0;O<o.height;O++){for(var x=0;x<o.width;x++)E[O*y+x]=o.data[O*o.width+x];for(x=0;x<f.width;x++)E[O*y+x+o.width]=f.data[O*f.width+x]}return{data:E,width:y,height:o.height}}(t,function(o){for(var f=o.data,y=o.width,E=o.height,O=new Array(f.length),x=0;x<E;x++)for(var I=0;I<y;I++)O[x*y+I]=f[x*y+y-1-I];return{data:O,width:y,height:E}}(t)),s=0;s<t.height;s++)for(var l=-r;l<t.width+r;l++)n[s*a+l+r]=w.data[s*w.width+i.mod(l,w.width)];return{data:n,width:a,height:t.height}}(v,h),u)}},582:(p,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.rgb2grayInteger=e.rgb2gray=void 0,e.rgb2gray=function(c){for(var i=c.data,v=c.width,m=c.height,g=new Uint8Array(v*m),d=0;d<i.length;d+=4)g[d/4]=.29894*i[d]+.58704*i[d+1]+.11402*i[d+2]+.5;return{data:Array.from(g),width:v,height:m}},e.rgb2grayInteger=function(c){for(var i=c.data,v=c.width,m=c.height,g=new Array(v*m),d=0;d<i.length;d+=4)g[d/4]=77*i[d]+150*i[d+1]+29*i[d+2]+128>>8;return{data:g,width:v,height:m}}},439:(p,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.skip2d=void 0,e.skip2d=function(c,i,v){for(var m=i[0],g=i[1],d=i[2],u=v[0],h=v[1],t=v[2],r=Math.ceil((t-u)/h),a=Math.ceil((d-m)/g),n=new Array(r*a),w=0;w<a;w++)for(var s=0;s<r;s++){var l=m+w*g,o=u+s*h;n[w*r+s]=c.data[l*c.width+o]}return{data:n,width:r,height:a}}},118:(p,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.sub=void 0,e.sub=function(c,i,v,m,g){for(var d=c.data,u=c.width,h=new Array(g*v),t=0;t<v;t++)for(var r=0;r<g;r++)h[t*g+r]=d[(m+t)*u+i+r];return{data:h,width:g,height:v}}},240:(p,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.transpose=void 0,e.transpose=function(c){for(var i=c.data,v=c.width,m=c.height,g=new Array(v*m),d=0;d<m;d++)for(var u=0;u<v;u++)g[u*m+d]=i[d*v+u];return{data:g,height:v,width:m}}},799:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.zeros=void 0;var i=c(928);e.zeros=function(v,m){return m===void 0&&(m=v),i.numbers(v,m,0)}},595:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.originalSsim=void 0;var i=c(490),v=c(971);e.originalSsim=function(m,g,d){var u=v.fspecial("gaussian",d.windowSize,1.5),h=Math.pow(2,d.bitDepth)-1,t=Math.pow(d.k1*h,2),r=Math.pow(d.k2*h,2);u=i.divide2d(u,i.sum2d(u));var a=v.filter2(u,m,"valid"),n=v.filter2(u,g,"valid"),w=i.square2d(a),s=i.square2d(n),l=i.multiply2d(a,n),o=i.square2d(m),f=i.square2d(g),y=i.subtract2d(v.filter2(u,o,"valid"),w),E=i.subtract2d(v.filter2(u,f,"valid"),s),O=i.subtract2d(v.filter2(u,i.multiply2d(m,g),"valid"),l);if(t>0&&r>0){var x=i.add2d(i.multiply2d(l,2),t),I=i.add2d(i.multiply2d(O,2),r),j=i.add2d(i.add2d(w,s),t),P=i.add2d(i.add2d(y,E),r);return i.divide2d(i.multiply2d(x,I),i.multiply2d(j,P))}var S=i.multiply2d(l,2),k=i.multiply2d(O,2),z=i.add2d(w,s),q=i.add2d(y,E);return i.divide2d(i.multiply2d(S,k),i.multiply2d(z,q))}},773:(p,e,c)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ssim=void 0;var i=c(490),v=c(971);e.ssim=function(m,g,d){var u=v.normpdf(function(I){for(var j=Math.floor(I/2),P=new Array(2*j+1),S=-j;S<=j;S++)P[S+j]=Math.abs(S);return{data:P,width:P.length,height:1}}(d.windowSize),0,1.5),h=Math.pow(2,d.bitDepth)-1,t=Math.pow(d.k1*h,2),r=Math.pow(d.k2*h,2);u=i.divide2d(u,i.sum2d(u));var a=v.transpose(u),n=v.conv2(m,u,a,"valid"),w=v.conv2(g,u,a,"valid"),s=i.square2d(n),l=i.square2d(w),o=i.multiply2d(n,w),f=i.square2d(m),y=i.square2d(g),E=i.subtract2d(v.conv2(f,u,a,"valid"),s),O=i.subtract2d(v.conv2(y,u,a,"valid"),l),x=i.subtract2d(v.conv2(i.multiply2d(m,g),u,a,"valid"),o);return t>0&&r>0?function(I,j,P,S,k,z,q,R){var D=i.add2d(i.multiply2d(I,2),q),B=i.add2d(i.multiply2d(j,2),R),U=i.add2d(i.add2d(P,S),q),Y=i.add2d(i.add2d(k,z),R);return i.divide2d(i.multiply2d(D,B),i.multiply2d(U,Y))}(o,x,s,l,E,O,t,r):function(I,j,P,S,k,z){var q=i.multiply2d(I,2),R=i.multiply2d(j,2),D=i.add2d(P,S),B=i.add2d(k,z);return i.divide2d(i.multiply2d(q,R),i.multiply2d(D,B))}(o,x,s,l,E,O)}},535:function(p,e){var c=this&&this.__assign||function(){return(c=Object.assign||function(t){for(var r,a=1,n=arguments.length;a<n;a++)for(var w in r=arguments[a])Object.prototype.hasOwnProperty.call(r,w)&&(t[w]=r[w]);return t}).apply(this,arguments)};function i(t,r,a,n){return{rightEdge:a[r*n+t+1],bottomEdge:a[(r+1)*n+t],bottomRightEdge:a[(r+1)*n+t+1]}}function v(t,r){for(var a=t.width,n=t.height,w=t.data,s=a+1,l=n+1,o=new Int32Array(s*l),f=n-1;f>=0;--f)for(var y=a-1;y>=0;--y){var E=i(y,f,o,s),O=E.rightEdge,x=E.bottomEdge,I=E.bottomRightEdge;o[f*s+y]=r(w[f*a+y],y,f)+O+x-I}return{data:o,height:l,width:s}}function m(t,r,a){for(var n=t.width,w=t.height,s=t.data,l=r.data,o=n+1,f=w+1,y=new Int32Array(o*f),E=w-1;E>=0;--E)for(var O=n-1;O>=0;--O){var x=i(O,E,y,o),I=x.rightEdge,j=x.bottomEdge,P=x.bottomRightEdge,S=E*n+O;y[E*o+O]=a(s[S],l[S],O,E)+I+j-P}return{data:y,height:f,width:o}}function g(t,r,a){for(var n=t.width,w=t.height,s=t.data,l=n-1,o=w-1,f=l-r+1,y=o-r+1,E=new Int32Array(f*y),O=0;O<o;++O)for(var x=0;x<l;++x)if(x<f&&O<y){var I=s[n*O+x]-s[n*O+x+r]-s[n*(O+r)+x]+s[n*(O+r)+x+r];E[O*f+x]=I/a}return{height:y,width:f,data:E}}function d(t,r){return g(v(t,function(a){return a}),r,1)}function u(t,r,a){for(var n=a*a,w=g(v(t,function(y){return y*y}),a,1),s=0;s<r.data.length;++s){var l=r.data[s]/n,o=w.data[s]/n,f=l*l;w.data[s]=1024*(o-f)}return w}function h(t,r,a,n,w){for(var s=w*w,l=g(m(t,r,function(f,y){return f*y}),w,1),o=0;o<a.data.length;++o)l.data[o]=1024*(l.data[o]/s-a.data[o]/s*(n.data[o]/s));return l}Object.defineProperty(e,"__esModule",{value:!0}),e.weberSsim=e.windowCovariance=e.windowVariance=e.windowSums=e.windowMatrix=e.partialSumMatrix2=e.partialSumMatrix1=void 0,e.partialSumMatrix1=v,e.partialSumMatrix2=m,e.windowMatrix=g,e.windowSums=d,e.windowVariance=u,e.windowCovariance=h,e.weberSsim=function(t,r,a){for(var n=a.bitDepth,w=a.k1,s=a.k2,l=a.windowSize,o=Math.pow(2,n)-1,f=w*o*(w*o),y=s*o*(s*o),E=l*l,O=c(c({},t),{data:Int32Array.from(t.data,function(X){return X+.5})}),x=c(c({},r),{data:Int32Array.from(r.data,function(X){return X+.5})}),I=d(O,l),j=u(O,I,l),P=d(x,l),S=u(x,P,l),k=h(O,x,I,P,l),z=I.data.length,q=0,R=new Array(z),D=0;D<z;++D){var B=I.data[D]/E,U=P.data[D]/E,Y=j.data[D]/1024,et=S.data[D]/1024,N=(2*B*U+f)*(k.data[D]/1024*2+y)/(B*B+U*U+f)/(Y+et+y);R[D]=N,D==0?q=N:q+=(N-q)/(D+1)}return{data:R,width:I.width,height:I.height,mssim:q}}}},A={};return function p(e){if(A[e])return A[e].exports;var c=A[e]={exports:{}};return M[e].call(c.exports,c,c.exports,p),c.exports}(607)})()})}(F)),F.exports}var nt=at();function rt(_,b,M,A,p,e={}){const{threshold:c=.1,alpha:i=.1,aaColor:v=[255,255,0],diffColor:m=[255,0,0],includeAA:g,diffColorAlt:d,diffMask:u}=e;if(!J(_)||!J(b)||M&&!J(M))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(_.length!==b.length||M&&M.length!==_.length)throw new Error("Image sizes do not match.");if(_.length!==A*p*4)throw new Error("Image data size does not match width/height.");const h=A*p,t=new Uint32Array(_.buffer,_.byteOffset,h),r=new Uint32Array(b.buffer,b.byteOffset,h);let a=!0;for(let j=0;j<h;j++)if(t[j]!==r[j]){a=!1;break}if(a){if(M&&!u)for(let j=0;j<h;j++)$(_,4*j,i,M);return 0}const n=35215*c*c,[w,s,l]=v,[o,f,y]=m,[E,O,x]=d||m;let I=0;for(let j=0;j<p;j++)for(let P=0;P<A;P++){const S=j*A+P,k=S*4,z=t[S]===r[S]?0:W(_,b,k,k,!1);if(Math.abs(z)>n){const q=Z(_,P,j,A,p,t,r)||Z(b,P,j,A,p,r,t);!g&&q?M&&!u&&L(M,k,w,s,l):(M&&(z<0?L(M,k,E,O,x):L(M,k,o,f,y)),I++)}else M&&!u&&$(_,k,i,M)}return I}function J(_){return ArrayBuffer.isView(_)&&_.BYTES_PER_ELEMENT===1}function Z(_,b,M,A,p,e,c){const i=Math.max(b-1,0),v=Math.max(M-1,0),m=Math.min(b+1,A-1),g=Math.min(M+1,p-1),d=M*A+b;let u=b===i||b===m||M===v||M===g?1:0,h=0,t=0,r=0,a=0,n=0,w=0;for(let s=i;s<=m;s++)for(let l=v;l<=g;l++){if(s===b&&l===M)continue;const o=W(_,_,d*4,(l*A+s)*4,!0);if(o===0){if(u++,u>2)return!1}else o<h?(h=o,r=s,a=l):o>t&&(t=o,n=s,w=l)}return h===0||t===0?!1:C(e,r,a,A,p)&&C(c,r,a,A,p)||C(e,n,w,A,p)&&C(c,n,w,A,p)}function C(_,b,M,A,p){const e=Math.max(b-1,0),c=Math.max(M-1,0),i=Math.min(b+1,A-1),v=Math.min(M+1,p-1),m=_[M*A+b];let g=b===e||b===i||M===c||M===v?1:0;for(let d=e;d<=i;d++)for(let u=c;u<=v;u++)if(!(d===b&&u===M)&&(g+=+(m===_[u*A+d]),g>2))return!0;return!1}function W(_,b,M,A,p){const e=_[M],c=_[M+1],i=_[M+2],v=_[M+3],m=b[A],g=b[A+1],d=b[A+2],u=b[A+3];let h=e-m,t=c-g,r=i-d;const a=v-u;if(!h&&!t&&!r&&!a)return 0;if(v<255||u<255){const o=48+159*(M%2),f=48+159*((M/1.618033988749895|0)%2),y=48+159*((M/2.618033988749895|0)%2);h=(e*v-m*u-o*a)/255,t=(c*v-g*u-f*a)/255,r=(i*v-d*u-y*a)/255}const n=h*.29889531+t*.58662247+r*.11448223;if(p)return n;const w=h*.59597799-t*.2741761-r*.32180189,s=h*.21147017-t*.52261711+r*.31114694,l=.5053*n*n+.299*w*w+.1957*s*s;return n>0?-l:l}function L(_,b,M,A,p){_[b+0]=M,_[b+1]=A,_[b+2]=p,_[b+3]=255}function $(_,b,M,A){const p=255+(_[b]*.29889531+_[b+1]*.58662247+_[b+2]*.11448223-255)*M*_[b+3]/255;L(A,b,p,p,p)}const K=document.querySelector("input#pixel"),it=document.querySelector("input#ssim"),V=document.querySelector("img#baseline"),dt=document.querySelector("img#diff"),T=document.querySelector("img#new");function tt(_,b){return new Promise(M=>{_.onload=()=>{M()},_.src=URL.createObjectURL(b)})}function ot(_,b,M,A){const p=new ImageData(b,M,A),e=document.createElement("canvas"),c=e.getContext("2d");e.width=p.width,e.height=p.height,c.putImageData(p,0,0),_.src=e.toDataURL()}function H(_,b,M){const A=document.createElement("canvas"),p=A.getContext("2d");return A.width=b,A.height=M,p.drawImage(_,0,0),p.getImageData(0,0,b,M).data}document.getElementById("input").addEventListener("change",async _=>{const b=_.currentTarget.files?.[0];!b||!await b?.arrayBuffer()||(await tt(V,b),G())});K.addEventListener("change",()=>{G()});it.addEventListener("change",()=>{G()});document.getElementById("output").addEventListener("change",async _=>{const b=_.currentTarget.files?.[0];!b||!await b?.arrayBuffer()||(await tt(T,b),G())});function G(){const _=Math.max(V.naturalWidth,T.naturalWidth),b=Math.max(V.naturalHeight,T.naturalHeight),M=H(V,_,b),A=H(T,_,b),p=new Uint8ClampedArray(_*b*4),e=K.checked?{threshold:.01}:{ssim:"bezkrovny"};(K.checked?rt:ut)(A,M,p,_,b,e),ot(dt,p,_,b)}function ut(_,b,M,A,p,e){const c={data:_,width:A,height:p},i={data:b,width:A,height:p},{ssim_map:v,mssim:m}=nt.ssim(c,i,e),g=(1-m)*A*p,d=new DataView(M.buffer,M.byteOffset);for(let u=0;u!==p;++u)for(let h=0;h!==A;++h){const t=u*A+h,r=4278190080+Math.floor(255*(1-(v.data[v.width*Math.round(v.height*u/p)+Math.round(v.width*h/A)]??0)));d.setUint32(t*4,r)}return g}
//# sourceMappingURL=diff.astro_astro_type_script_index_0_lang.CBYdhI_G.js.map
