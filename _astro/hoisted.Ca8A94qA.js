import{j as e}from"./jsx-runtime.CYYqVSlZ.js";import{R as c,r as a}from"./index.DJO9vBfz.js";import{r as w,c as W}from"./client.CjAdBq2B.js";import"./index.CzFDRTuY.js";function D(t){(function(){t("sync")})()}function k(t){queueMicrotask(function(){t("micro task")})}function H(t){scheduler.postTask(function(){t("task (user-blocking)")},{priority:"user-blocking"})}function N(t){scheduler.postTask(function(){t("task (user-visible)")},{priority:"user-visible"})}function O(t){scheduler.postTask(function(){t("task (background)")},{priority:"background"})}function p(t){const n=new MessageChannel;n.port1.postMessage(null),n.port2.addEventListener("message",function(){t("task")},{once:!0}),n.port2.start()}function b(t){requestAnimationFrame(function(){t("animation frame")})}function _(t,n=!1){n&&(O(t),N(t),H(t)),p(t),b(t),k(t),D(t)}function F(t){return t?"Now: "+performance.now().toFixed(1)+"ms | Timeline: "+document.timeline.currentTime+"ms | ":""}function l(t,{tasks:n,timings:r=!1,style:o="",nestedLogMessage:s}={}){if(!n){console.log(F(r)+t,o);return}const d=["font-style: italic; text-decoration-line: underline",""];_(u=>{console.log(F(r)+"%c"+u+"%c "+t,...d,o),s&&l("< "+u+" "+s,{tasks:n,timings:r,style:o})},n==="all")}const L=()=>`lch(${Math.floor(Math.random()*20)+50}% ${Math.floor(Math.random()*50)+50} ${Math.floor(Math.random()*360)})`;let R=65;const C=c.createContext({tasks:!1,timings:!1}),B=c.createContext(new Set);class g extends c.Component{constructor(){super(...arguments),this.state={error:!1},this.suspenses=new Set}static getDerivedStateFromError(){return{error:!0}}static{this.contextType=C}render(){return this.state.error?e.jsx("div",{style:{border:"4px dotted red"},children:"Oops"}):e.jsx(B.Provider,{value:this.suspenses,children:e.jsx(c.Suspense,{fallback:e.jsx("div",{style:{border:"4px dotted blue",padding:"4px"},onClick:()=>{l("resolve promises",this.context);for(const n of this.suspenses)n();this.suspenses.clear()},children:"â¸ï¸"}),children:e.jsx("div",{style:{border:"2px double OrangeRed",padding:"4px"},children:this.props.children})})})}}function y(){const[t,n]=c.useState(!1);if(t)throw new Error("oops");return e.jsx("span",{onClick:()=>n(!0),title:"throw error",children:"ðŸ’¥"})}const S=new Map,V=t=>{const n={},r=new Promise(o=>{t.add(()=>{o(),S.delete(n)})});return S.set(n,r),n};function v(){const[t,n]=c.useState({}),r=S.get(t),o=c.useContext(B);if(r)throw r;return e.jsx("span",{onClick:()=>n(V(o)),title:"trigger infinite suspense",children:"ðŸš§"})}function q(){const t={width:"2ch",display:"inline-block",height:"0.5ex"};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{style:{...t,borderTop:"2px solid "+L()}})," ","Component"]}),e.jsxs("div",{children:[e.jsx("span",{style:{...t,borderTop:"2px double orangered"}})," Error + Suspense boundary"]}),e.jsxs("div",{children:[e.jsx("span",{style:{...t,borderTop:"4px dotted red"}})," Error was thrown & caught"]}),e.jsxs("div",{children:[e.jsx("span",{style:{...t,borderTop:"4px dotted blue"}})," Suspense in progress"]})]})}class m extends c.Component{constructor(n){super(n),this.color=L(),this.componentId=String.fromCharCode(R++),this.boundLog("constructor")}static{this.contextType=C}boundLog(n){l(`%cComponent ${this.componentId}: ${n}`,{...this.context,style:`color: ${this.color}`})}componentWillMount(){this.boundLog("componentWillMount")}componentWillReceiveProps(){this.boundLog("componentWillReceiveProps")}componentWillUpdate(){this.boundLog("componentWillUpdate")}componentDidMount(){this.boundLog("componentDidMount")}componentDidUpdate(){this.boundLog("componentDidUpdate")}shouldComponentUpdate(){return this.boundLog("shouldComponentUpdate"),!0}getSnapshotBeforeUpdate(){return this.boundLog("getSnapshotBeforeUpdate"),""}componentWillUnmount(){this.boundLog("componentWillUnmount")}render(){return this.boundLog("render"),e.jsxs("div",{ref:function(r){this.boundLog("ref "+(r?"node":"null"))}.bind(this),style:{border:`2px solid ${this.color}`},children:[e.jsxs("div",{children:[this.componentId,e.jsx("span",{onClick:()=>{h(),this.forceUpdate()},title:"re-render",children:"ðŸ”„"}),e.jsx(y,{}),e.jsx(v,{})]}),e.jsx("div",{style:{display:"grid",gridAutoFlow:"column"},children:this.props.children})]})}}class K extends m{render(){return this.boundLog("render"),e.jsxs("div",{ref:function(r){this.boundLog("ref "+(r?"node":"null"))}.bind(this),style:{border:`2px solid ${this.color}`},children:[e.jsxs("div",{children:[this.componentId,"*",e.jsx("span",{onClick:()=>{h(),this.forceUpdate()},title:"re-render",children:"ðŸ”„"}),e.jsx(y,{}),e.jsx(v,{})]}),e.jsxs("div",{style:{display:"grid",gridAutoFlow:"column"},children:[e.jsx("span",{}),e.jsx(m,{}),e.jsx("span",{})]})]})}}function z(){return e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(m,{children:e.jsx(m,{})})}),e.jsx(g,{children:e.jsx(K,{})})]})}const P=()=>{const t=c.useMemo(()=>L(),[]),n=c.useMemo(()=>String.fromCharCode(R++),[]),r=c.useContext(C),o=c.useRef(null),s=c.useCallback(i=>{l(`%cComponent ${n}: ${i}`,{...r,style:`color: ${t}`})},[r]);s("render");const[,d]=c.useState({});return c.useMemo(function(){s("useMemo")},[]),c.useInsertionEffect(function(){return s("useInsertionEffect "+(o.current?"node":"null")),function(){s("useInsertionEffect cleanup "+(o.current?"node":"null"))}}),c.useLayoutEffect(function(){return s("useLayoutEffect "+(o.current?"node":"null")),function(){s("useLayoutEffect cleanup "+(o.current?"node":"null"))}}),c.useEffect(function(){return s("useEffect "+(o.current?"node":"null")),function(){s("useEffect cleanup "+(o.current?"node":"null"))}}),{log:s,color:t,componentId:n,forceUpdate:d,elementRef:o}};function j({children:t}){const{log:n,color:r,componentId:o,forceUpdate:s,elementRef:d}=P();return e.jsxs("div",{ref:function(u){d.current=u,n("ref "+(u?"node":"null"))},style:{border:`2px solid ${r}`},children:[e.jsxs("div",{children:[o,e.jsx("span",{onClick:()=>{h(),s({})},title:"re-render",children:"ðŸ”„"}),e.jsx(y,{}),e.jsx(v,{})]}),e.jsx("div",{style:{display:"grid",gridAutoFlow:"column"},children:t})]})}function G(){const{log:t,color:n,componentId:r,forceUpdate:o,elementRef:s}=P();return e.jsxs("div",{ref:function(i){s.current=i,t("ref "+(i?"node":"null"))}.bind(this),style:{border:`2px solid ${n}`},children:[e.jsxs("div",{children:[r,"*",e.jsx("span",{onClick:()=>{h(),o({})},title:"re-render",children:"ðŸ”„"}),e.jsx(y,{}),e.jsx(v,{})]}),e.jsxs("div",{style:{display:"grid",gridAutoFlow:"column"},children:[e.jsx("span",{}),e.jsx(j,{}),e.jsx("span",{})]})]})}function J(){return e.jsxs(j,{children:[e.jsx(g,{children:e.jsx(j,{children:e.jsx(j,{})})}),e.jsx(g,{children:e.jsx(G,{})})]})}const T={class:z,function:J};function h(){console.clear(),R=65}function Q(){const[t,n]=c.useState(null),[,r]=c.useState({}),o=T[t],[s,d]=c.useState(!1),[i,u]=c.useState(!1),A=c.useMemo(()=>({timings:s,tasks:i?"all":!1}),[s,i]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Pick example:",Object.keys(T).map(f=>e.jsx("button",{onClick:()=>{T[f]!==o&&(h(),n(f))},children:f},f))]}),e.jsxs("div",{style:{marginTop:"0.5em"},children:["Timing ",s?"enabled ":"disabled ",e.jsx("button",{title:`Toggle timing to ${s?"disabled ":"enabled "}`,onClick:()=>{h(),d(f=>!f)},children:s?"ï¸âŒ›":"â³"})]}),e.jsxs("div",{style:{marginBottom:"0.5em"},children:["Tasks ",i?"enabled ":"disabled ",e.jsx("button",{title:`Toggle tasks to ${i?"disabled ":"enabled "}`,onClick:()=>{h(),u(f=>!f)},children:i?"ï¸ðŸª«":"ðŸ”‹"})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"0.5em"},children:[e.jsx("button",{onClick:()=>{h(),n(null)},children:"Remove all"}),e.jsx("button",{onClick:()=>{h(),r({})},children:"Re-render"})]}),e.jsx("div",{className:"grow",children:e.jsx(C.Provider,{value:A,children:e.jsx(g,{children:e.jsx(o,{},String(s)+"-"+String(i))})})}),e.jsx("div",{style:{marginTop:"0.5em"},children:e.jsx(q,{})})]})]})}function X(){const[t,n]=a.useState(!1),[r,o]=a.useState(!1),[s,d]=a.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t?"2 levels":"Only 1 level",e.jsx("button",{onClick:()=>n(i=>!i),children:t?"â¤´ï¸":"â¤µï¸"})]}),e.jsxs("div",{children:["Timing ",r?"enabled ":"disabled ",e.jsx("button",{onClick:()=>{o(i=>!i)},children:r?"ï¸âŒ›":"â³"})]}),e.jsxs("div",{style:{marginBottom:"0.5em"},children:[s?"All tasks":"Some tasks",e.jsx("button",{onClick:()=>d(i=>!i),children:"ðŸ”€"})]}),e.jsx("button",{onClick:()=>{console.clear(),l("from React onClick",{tasks:s?"all":!0,timings:r,nestedLogMessage:t?"| from React onClick":void 0})},children:"Trigger from a React onClick"}),e.jsx("button",{ref:i=>{i&&(i.onclick=()=>{console.clear(),l("from HTML onClick",{tasks:s?"all":!0,timings:r,nestedLogMessage:t?"| from HTML onClick":void 0})})},children:"Trigger from a HTML onClick"}),e.jsx("button",{onClick:()=>k(()=>{console.clear(),l("from micro task",{tasks:s?"all":!0,timings:r,nestedLogMessage:t?"| from micro task":void 0})}),children:"Trigger from a micro task"}),e.jsx("button",{onClick:()=>p(()=>{console.clear(),l("from task",{tasks:s?"all":!0,timings:r,nestedLogMessage:t?"| from task":void 0})}),children:"Trigger from a task"}),e.jsx("button",{onClick:()=>p(()=>{console.clear(),l("from user-blocking task",{tasks:s?"all":!0,timings:r,nestedLogMessage:t?"| from user-blocking task":void 0})}),children:"Trigger from a user-blocking task"}),e.jsx("button",{onClick:()=>b(()=>{console.clear(),l("from animation frame",{tasks:s?"all":!0,timings:r,nestedLogMessage:t?"| from animation frame":void 0})}),children:"Trigger from a animation frame"}),e.jsx("button",{onClick:()=>setTimeout(()=>{console.clear(),l("from setTimeout",{tasks:s?"all":!0,timings:r,nestedLogMessage:t?"| from setTimeout":void 0})},50),children:"Trigger from a setTimeout"})]})}function Y(){return e.jsx(e.Fragment,{children:e.jsx("button",{onClickCapture:()=>{console.clear(),l("from onClickCapture",{tasks:!0})},onClick:()=>{l("from onClick",{tasks:!0})},children:"Click me"})})}function E({label:t,children:n,style:r}){const[o,s]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{style:{marginBottom:o?"0.5em":void 0,...r},onClick:()=>s(d=>!d),children:[o?"Hide":"Display"," ",t]}),o&&n]})}let x=!1;function Z(){return e.jsxs(e.Fragment,{children:[e.jsx(E,{label:"re-render in useEffect",children:e.jsx(ee,{})}),e.jsxs(E,{style:{marginTop:"1em"},label:"re-render timings",children:[e.jsx("button",{onClick:t=>{x=!x,t.currentTarget.innerHTML=x?"Disable flushSync":"Enable flushSync"},dangerouslySetInnerHTML:{__html:"Enable flushSync"}}),e.jsx(te,{}),e.jsx(ne,{})]})]})}function ee(){const[,t]=a.useState({});return console.log("render"),a.useEffect(()=>{console.log("mount that has a re-render"),t({})},[]),a.useEffect(()=>{console.log("effect with no side effects")}),"âœ…"}function te(){const[t,n]=a.useState(1),[r,o]=a.useState(1);console.log("render",{a:t,b:r});const s=()=>{console.clear(),l("click (before re-renders)",{tasks:!0}),x?(w.flushSync(()=>n(d=>d+1)),l("click (between re-renders, after flushSync)",{tasks:!0})):(n(d=>d+1),l("click (between re-renders)",{tasks:!0})),o(d=>d+1),l("click (after re-renders)",{tasks:!0})};return e.jsxs("div",{children:[e.jsx("div",{children:"Function:"}),e.jsx("button",{onClick:s,children:"onClick"}),e.jsx("button",{onClick:()=>k(s),children:"Micro task"}),e.jsx("button",{onClick:()=>p(s),children:"Task"}),e.jsx("button",{onClick:()=>b(s),children:"Animation frame"})]})}class ne extends a.Component{constructor(){super(...arguments),this.state={a:1,b:1},this.update=()=>{console.clear(),l("click (before re-renders)",{tasks:!0}),x?(w.flushSync(()=>this.setState(n=>({...n,a:n.a+1}),()=>{console.log("Set state for a is done")})),l("click (between re-renders, after flushSync)",{tasks:!0})):(this.setState(n=>({...n,a:n.a+1}),()=>{console.log("Set state for a is done")}),l("click (between re-renders)",{tasks:!0})),this.setState(n=>({...n,b:n.b+1}),()=>{console.log("Set state for b is done")}),l("click (after re-renders)",{tasks:!0})}}render(){return console.log("render",this.state),e.jsxs("div",{children:[e.jsx("div",{children:"Class:"}),e.jsx("button",{onClick:this.update,children:"onClick"}),e.jsx("button",{onClick:()=>k(this.update),children:"Micro task"}),e.jsx("button",{onClick:()=>p(this.update),children:"Task"}),e.jsx("button",{onClick:()=>b(this.update),children:"Animation frame"})]})}}const $=a.createContext(0);function se(){return e.jsx(E,{label:"re-render through Context",children:e.jsx(re,{children:e.jsx(oe,{children:e.jsx(ie,{})})})})}function re({children:t}){const[n,r]=a.useState(0),[,o]=a.useState({});return l("render Provider",{tasks:!0}),e.jsxs("div",{style:{padding:2,border:"2px solid red"},children:["Provider",e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{l("re-render Provider",{tasks:!0}),r(s=>s+1)},children:"Update context"}),e.jsx("button",{style:{marginBottom:"0.5em"},onClick:()=>o({}),children:"Update local state"})]}),e.jsx($.Provider,{value:n,children:t})]})}const oe=a.memo(({children:t})=>(l("render PassThrough"),e.jsxs("div",{style:{padding:2,border:"2px solid green"},children:[e.jsx("div",{children:"PassThrough"}),t]}))),ie=a.memo(()=>{l("render Child");const t=a.useContext($);return e.jsxs("div",{style:{padding:2,border:"2px solid blue"},children:["Child ",t]})});function I(){return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Test how component (re-)renders"}),e.jsx(Q,{}),e.jsx("hr",{}),e.jsx("h2",{children:"Test tasks ordering"}),e.jsx(X,{}),e.jsx("hr",{}),e.jsx("h2",{children:"Test event capture / event bubble"}),e.jsx(Y,{}),e.jsx("hr",{}),e.jsx("h2",{children:"Test re-renders"}),e.jsx(Z,{}),e.jsx("hr",{}),e.jsx("h2",{children:"Context re-rendering"}),e.jsx(se,{})]})}const M=!!sessionStorage.getItem("legacyRoot");function le(){return e.jsx(e.Fragment,{children:e.jsxs("button",{onClick:()=>{M?sessionStorage.removeItem("legacyRoot"):sessionStorage.setItem("legacyRoot","true"),window.location.reload()},children:["Switch to ",M?"concurrent":"legacy"]})})}const U=document.getElementById("root");M?w.render(e.jsx(I,{}),U):W(U).render(e.jsx(I,{}));W(document.getElementById("switcher")).render(e.jsx(le,{}));
