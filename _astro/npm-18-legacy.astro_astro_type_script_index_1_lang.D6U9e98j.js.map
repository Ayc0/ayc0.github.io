{"version":3,"file":"npm-18-legacy.astro_astro_type_script_index_1_lang.D6U9e98j.js","sources":["../../src/components/experiments/page-react-extension/npm-18-legacy/App.js","../../src/components/experiments/page-react-extension/npm-18-legacy/index.js"],"sourcesContent":["import * as React from \"react-18\";\n// import { getFiberStack, getDisplayName, type Fiber } from \"bippy\";\nimport { getFiberData, getFiberFromElement } from \"../fiber\";\nimport { getErrorStackFromInfo } from \"../error\";\n\n// Can't use JSX as it will collide with Astro rendering\n\nclass ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static displayName = \"ErrorBoundary\";\n\n  static getDerivedStateFromError(_error) {\n    // Update state so the next render will show the fallback UI.\n    return { hasError: true };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    console.log(\"[CUSTOM] componentDidCatch\", {\n      errorStack: getErrorStackFromInfo(errorInfo),\n      error,\n    });\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return this.props.fallback || null;\n    }\n\n    return React.createElement(\n      \"fieldset\",\n      { style: { display: \"inline\", border: \"1px solid red\" } },\n      React.createElement(\"legend\", null, \"Error Boundary\"),\n      this.props.children,\n    );\n  }\n}\n\nconst ErrorThrowerOnClick = () => {\n  return React.createElement(\n    \"button\",\n    {\n      onClick: () => {\n        throw new Error(\"Hello\");\n      },\n    },\n    \"Trigger \\uD83D\\uDCA5 crash (in onClick)\",\n  );\n};\nErrorThrowerOnClick.displayName = \"ErrorThrowerOnClick\";\n\nfunction ErrorThrowerOnRender() {\n  const [aaaa, setAaaa] = React.useState(false);\n  if (aaaa) {\n    throw new Error(\"Hello\");\n  }\n\n  return React.createElement(\n    \"button\",\n    {\n      onClick: () => {\n        setAaaa(true);\n      },\n    },\n    \"Trigger \\uD83D\\uDCA5 crash (on render)\",\n  );\n}\nErrorThrowerOnRender.displayName = \"ErrorThrowerOnRender\";\n\nconst ErrorThrowerOnEffect = () => {\n  const [aaaa, setAaaa] = React.useState(false);\n\n  React.useEffect(() => {\n    if (aaaa) {\n      throw new Error(\"Hello\");\n    }\n  }, [aaaa]);\n\n  return React.createElement(\n    \"button\",\n    {\n      onClick: () => {\n        setAaaa(true);\n      },\n    },\n    \"Trigger \\uD83D\\uDCA5 crash (on effect)\",\n  );\n};\nErrorThrowerOnEffect.displayName = \"ErrorThrowerOnEffect\";\n\nconst ClickTracker = ({ children }) => {\n  return React.createElement(\n    \"fieldset\",\n    {\n      style: { display: \"inline\", border: \"1px dashed blue\" },\n      onClick: (event) => {\n        const fiber = getFiberFromElement(event.target);\n        if (!fiber) {\n          return;\n        }\n        const fiberData = getFiberData(fiber);\n        console.log(\"[CUSTOM] Clicked on\", {\n          element: event.target,\n          fiber: fiber,\n          ...fiberData,\n        });\n      },\n    },\n    children,\n  );\n};\nClickTracker.displayName = \"ClickTracker\";\n\nconst Bar = () => {\n  return React.createElement(\n    ClickTracker,\n    null,\n    React.createElement(ErrorThrowerOnClick),\n    React.createElement(ErrorThrowerOnRender),\n    React.createElement(ErrorThrowerOnEffect),\n    React.createElement(\n      ErrorBoundary,\n      null,\n      React.createElement(ErrorThrowerOnClick),\n      React.createElement(ErrorThrowerOnRender),\n      React.createElement(ErrorThrowerOnEffect),\n    ),\n  );\n};\nBar.displayName = \"Bar\";\n\nconst Foo = () => {\n  return React.createElement(Bar);\n};\nFoo.displayName = \"Foo\";\n\nexport const App = () => {\n  return React.createElement(\n    React.Fragment,\n    null,\n    React.createElement(\"div\", null, \"Hello World\"),\n    React.createElement(Foo),\n  );\n};\nApp.displayName = \"App\";\n","// import { instrument, secure } from \"bippy\"; // must be imported BEFORE react\nimport * as React from \"react-18\";\nimport * as ReactDOM from \"react-dom-18\";\n\nimport { App } from \"./App\";\n// import type { Fiber } from \"bippy\";\n// import { getMutatedHostFibers, instrument, secure, type Fiber } from \"bippy\";\n// import { getFiberData /* , getRoot */ } from \"./fiber\";\n// import { getErrorStackFromInfo } from \"./error\";\n\n// instrument(\n//   secure({\n//     onCommitFiberRoot(rendererID, root) {\n//       console.log(\"root ready to commit\", rendererID, root);\n//       console.log(getMutatedHostFibers(root.current));\n//     },\n//     onPostCommitFiberRoot(rendererID, root) {\n//       console.log(\"root with effects committed\", rendererID, root);\n//     },\n//     onCommitFiberUnmount(rendererID, fiber) {\n//       console.log(\"fiber unmounted\", rendererID, fiber);\n//     },\n//   }),\n// );\n\nconst button = document.getElementById(\"button\");\n\nbutton.addEventListener(\"click\", () => {\n  ReactDOM.render(React.createElement(App), document.getElementById(`node`));\n  button.disabled = true;\n});\n"],"names":["ErrorBoundary","React.Component","props","_error","error","errorInfo","getErrorStackFromInfo","React.createElement","ErrorThrowerOnClick","ErrorThrowerOnRender","aaaa","setAaaa","React.useState","ErrorThrowerOnEffect","React.useEffect","ClickTracker","children","event","fiber","getFiberFromElement","fiberData","getFiberData","Bar","Foo","App","React.Fragment","button","ReactDOM.render"],"mappings":"yKAOA,MAAMA,UAAsBC,EAAAA,SAAgB,CAC1C,YAAYC,EAAO,CACjB,MAAMA,CAAK,EACX,KAAK,MAAQ,CAAE,SAAU,EAAK,CAChC,CAEA,OAAO,YAAc,gBAErB,OAAO,yBAAyBC,EAAQ,CAEtC,MAAO,CAAE,SAAU,EAAI,CACzB,CAEA,kBAAkBC,EAAOC,EAAW,CAClC,QAAQ,IAAI,6BAA8B,CACxC,WAAYC,EAAsBD,CAAS,EAC3C,MAAAD,CACN,CAAK,CACH,CAEA,QAAS,CACP,OAAI,KAAK,MAAM,SACN,KAAK,MAAM,UAAY,KAGzBG,EAAAA,cACL,WACA,CAAE,MAAO,CAAE,QAAS,SAAU,OAAQ,eAAe,CAAE,EACvDA,gBAAoB,SAAU,KAAM,gBAAgB,EACpD,KAAK,MAAM,QACjB,CACE,CACF,CAEA,MAAMC,EAAsB,IACnBD,EAAAA,cACL,SACA,CACE,QAAS,IAAM,CACb,MAAM,IAAI,MAAM,OAAO,CACzB,CACN,EACI,+BACJ,EAEAC,EAAoB,YAAc,sBAElC,SAASC,GAAuB,CAC9B,KAAM,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAe,EAAK,EAC5C,GAAIF,EACF,MAAM,IAAI,MAAM,OAAO,EAGzB,OAAOH,EAAAA,cACL,SACA,CACE,QAAS,IAAM,CACbI,EAAQ,EAAI,CACd,CACN,EACI,8BACJ,CACA,CACAF,EAAqB,YAAc,uBAEnC,MAAMI,EAAuB,IAAM,CACjC,KAAM,CAACH,EAAMC,CAAO,EAAIC,EAAAA,SAAe,EAAK,EAE5CE,OAAAA,EAAAA,UAAgB,IAAM,CACpB,GAAIJ,EACF,MAAM,IAAI,MAAM,OAAO,CAE3B,EAAG,CAACA,CAAI,CAAC,EAEFH,EAAAA,cACL,SACA,CACE,QAAS,IAAM,CACbI,EAAQ,EAAI,CACd,CACN,EACI,8BACJ,CACA,EACAE,EAAqB,YAAc,uBAEnC,MAAME,EAAe,CAAC,CAAE,SAAAC,KACfT,EAAAA,cACL,WACA,CACE,MAAO,CAAE,QAAS,SAAU,OAAQ,iBAAiB,EACrD,QAAUU,GAAU,CAClB,MAAMC,EAAQC,EAAoBF,EAAM,MAAM,EAC9C,GAAI,CAACC,EACH,OAEF,MAAME,EAAYC,EAAaH,CAAK,EACpC,QAAQ,IAAI,sBAAuB,CACjC,QAASD,EAAM,OACf,MAAOC,EACP,GAAGE,CACb,CAAS,CACH,CACN,EACIJ,CACJ,EAEAD,EAAa,YAAc,eAE3B,MAAMO,EAAM,IACHf,EAAAA,cACLQ,EACA,KACAR,EAAAA,cAAoBC,CAAmB,EACvCD,EAAAA,cAAoBE,CAAoB,EACxCF,EAAAA,cAAoBM,CAAoB,EACxCN,EAAAA,cACEP,EACA,KACAO,EAAAA,cAAoBC,CAAmB,EACvCD,EAAAA,cAAoBE,CAAoB,EACxCF,EAAAA,cAAoBM,CAAoB,CAC9C,CACA,EAEAS,EAAI,YAAc,MAElB,MAAMC,EAAM,IACHhB,EAAAA,cAAoBe,CAAG,EAEhCC,EAAI,YAAc,MAEX,MAAMC,EAAM,IACVjB,EAAAA,cACLkB,EAAAA,SACA,KACAlB,gBAAoB,MAAO,KAAM,aAAa,EAC9CA,EAAAA,cAAoBgB,CAAG,CAC3B,EAEAC,EAAI,YAAc,MC1HlB,MAAME,EAAS,SAAS,eAAe,QAAQ,EAE/CA,EAAO,iBAAiB,QAAS,IAAM,CACrCC,EAAAA,OAAgBpB,EAAAA,cAAoBiB,CAAG,EAAG,SAAS,eAAe,MAAM,CAAC,EACzEE,EAAO,SAAW,EACpB,CAAC"}