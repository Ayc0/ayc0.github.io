import{j as e}from"./jsx-runtime.CYYqVSlZ.js";import{R as l,r as k}from"./index.DJO9vBfz.js";import{r as W,c as w}from"./client.CjAdBq2B.js";import"./index.CzFDRTuY.js";function U(n){(function(){n("sync")})()}function R(n){queueMicrotask(function(){n("micro task")})}function $(n){scheduler.postTask(function(){n("task (user-blocking)")},{priority:"user-blocking"})}function B(n){scheduler.postTask(function(){n("task (user-visible)")},{priority:"user-visible"})}function A(n){scheduler.postTask(function(){n("task (background)")},{priority:"background"})}function C(n){const t=new MessageChannel;t.port1.postMessage(null),t.port2.addEventListener("message",function(){n("task")},{once:!0}),t.port2.start()}function F(n){requestAnimationFrame(function(){n("animation frame")})}function D(n,t=!1){t&&(A(n),B(n),$(n)),C(n),F(n),R(n),U(n)}function L(n){return n?"Now: "+performance.now().toFixed(1)+"ms | Timeline: "+document.timeline.currentTime+"ms | ":""}function d(n,{tasks:t,timings:o=!1,style:i="",nestedLogMessage:s}={}){if(!t){console.log(L(o)+n,i);return}const a=["font-style: italic; text-decoration-line: underline",""];D(c=>{console.log(L(o)+"%c"+c+"%c "+n,...a,i),s&&d("< "+c+" "+s,{tasks:t,timings:o,style:i})},t==="all")}const y=()=>`lch(${Math.floor(Math.random()*20)+50}% ${Math.floor(Math.random()*50)+50} ${Math.floor(Math.random()*360)})`;let v=65;const E=l.createContext({tasks:!1,timings:!1});class h extends l.Component{constructor(){super(...arguments),this.state={error:!1}}static getDerivedStateFromError(){return{error:!0}}render(){return this.state.error?e.jsx("div",{style:{border:"4px dotted red"},children:"Oops"}):e.jsx(l.Suspense,{fallback:e.jsx("div",{style:{border:"4px dotted blue",padding:"4px"},children:"⏸️"}),children:e.jsx("div",{style:{border:"2px double OrangeRed",padding:"4px"},children:this.props.children})})}}function p(){const[n,t]=l.useState(!1);if(n)throw new Error("oops");return e.jsx("span",{onClick:()=>t(!0),title:"throw error",children:"💥"})}function j(){const[n,t]=l.useState(!1);if(n)throw new Promise(o=>{});return e.jsx("span",{onClick:()=>t(!0),title:"trigger infinite suspense",children:"🚧"})}function N(){const n={width:"2ch",display:"inline-block",height:"0.5ex"};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{style:{...n,borderTop:"2px solid "+y()}})," ","Component"]}),e.jsxs("div",{children:[e.jsx("span",{style:{...n,borderTop:"2px double orangered"}})," Error + Suspense boundary"]}),e.jsxs("div",{children:[e.jsx("span",{style:{...n,borderTop:"4px dotted red"}})," Error was thrown & caught"]}),e.jsxs("div",{children:[e.jsx("span",{style:{...n,borderTop:"4px dotted blue"}})," Suspense in progress"]})]})}class f extends l.Component{constructor(t){super(t),this.color=y(),this.componentId=String.fromCharCode(v++),this.boundLog("constructor")}static{this.contextType=E}boundLog(t){d(`%cComponent ${this.componentId}: ${t}`,{...this.context,style:`color: ${this.color}`})}componentWillMount(){this.boundLog("componentWillMount")}componentWillReceiveProps(){this.boundLog("componentWillReceiveProps")}componentWillUpdate(){this.boundLog("componentWillUpdate")}componentDidMount(){this.boundLog("componentDidMount")}componentDidUpdate(){this.boundLog("componentDidUpdate")}shouldComponentUpdate(){return this.boundLog("shouldComponentUpdate"),!0}getSnapshotBeforeUpdate(){return this.boundLog("getSnapshotBeforeUpdate"),""}componentWillUnmount(){this.boundLog("componentWillUnmount")}render(){return this.boundLog("render"),e.jsxs("div",{ref:function(o){this.boundLog("ref "+(o?"node":"null"))}.bind(this),style:{border:`2px solid ${this.color}`},children:[e.jsxs("div",{children:[this.componentId,e.jsx("span",{onClick:()=>{u(),this.forceUpdate()},title:"re-render",children:"🔄"}),e.jsx(p,{}),e.jsx(j,{})]}),e.jsx("div",{style:{display:"grid",gridAutoFlow:"column"},children:this.props.children})]})}}class P extends f{render(){return this.boundLog("render"),e.jsxs("div",{ref:function(o){this.boundLog("ref "+(o?"node":"null"))}.bind(this),style:{border:`2px solid ${this.color}`},children:[e.jsxs("div",{children:[this.componentId,"*",e.jsx("span",{onClick:()=>{u(),this.forceUpdate()},title:"re-render",children:"🔄"}),e.jsx(p,{}),e.jsx(j,{})]}),e.jsxs("div",{style:{display:"grid",gridAutoFlow:"column"},children:[e.jsx("span",{}),e.jsx(f,{}),e.jsx("span",{})]})]})}}function O(){return e.jsxs(f,{children:[e.jsx(h,{children:e.jsx(f,{children:e.jsx(f,{})})}),e.jsx(h,{children:e.jsx(P,{})})]})}const I=()=>{const n=l.useMemo(()=>y(),[]),t=l.useMemo(()=>String.fromCharCode(v++),[]),o=l.useContext(E),i=l.useRef(null),s=l.useCallback(c=>{d(`%cComponent ${t}: ${c}`,{...o,style:`color: ${n}`})},[o]);s("render");const[a,r]=l.useState({});return l.useMemo(function(){s("useMemo")},[]),l.useInsertionEffect(function(){return s("useInsertionEffect "+(i.current?"node":"null")),function(){s("useInsertionEffect cleanup "+(i.current?"node":"null"))}},[a]),l.useLayoutEffect(function(){return s("useLayoutEffect "+(i.current?"node":"null")),function(){s("useLayoutEffect cleanup "+(i.current?"node":"null"))}},[a]),l.useEffect(function(){return s("useEffect "+(i.current?"node":"null")),function(){s("useEffect cleanup "+(i.current?"node":"null"))}},[a]),{log:s,color:n,componentId:t,forceUpdate:r,elementRef:i}};function x({children:n}){const{log:t,color:o,componentId:i,forceUpdate:s,elementRef:a}=I();return e.jsxs("div",{ref:function(c){a.current=c,t("ref "+(c?"node":"null"))},style:{border:`2px solid ${o}`},children:[e.jsxs("div",{children:[i,e.jsx("span",{onClick:()=>{u(),s({})},title:"re-render",children:"🔄"}),e.jsx(p,{}),e.jsx(j,{})]}),e.jsx("div",{style:{display:"grid",gridAutoFlow:"column"},children:n})]})}function H(){const{log:n,color:t,componentId:o,forceUpdate:i,elementRef:s}=I();return e.jsxs("div",{ref:function(r){s.current=r,n("ref "+(r?"node":"null"))}.bind(this),style:{border:`2px solid ${t}`},children:[e.jsxs("div",{children:[o,"*",e.jsx("span",{onClick:()=>{u(),i({})},title:"re-render",children:"🔄"}),e.jsx(p,{}),e.jsx(j,{})]}),e.jsxs("div",{style:{display:"grid",gridAutoFlow:"column"},children:[e.jsx("span",{}),e.jsx(x,{}),e.jsx("span",{})]})]})}function V(){return e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(x,{children:e.jsx(x,{})})}),e.jsx(h,{children:e.jsx(H,{})})]})}const b={class:O,function:V};function u(){console.clear(),v=65}function _(){const[n,t]=l.useState(null),[,o]=l.useState({}),i=b[n],[s,a]=l.useState(!1),[r,c]=l.useState(!1),g=l.useMemo(()=>({timings:s,tasks:r?"all":!1}),[s,r]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Pick example:",Object.keys(b).map(m=>e.jsx("button",{onClick:()=>{b[m]!==i&&(u(),t(m))},children:m},m))]}),e.jsxs("div",{style:{marginTop:"0.5em"},children:["Timing ",s?"enabled ":"disabled ",e.jsx("button",{title:`Toggle timing to ${s?"disabled ":"enabled "}`,onClick:()=>{u(),a(m=>!m)},children:s?"️⌛":"⏳"})]}),e.jsxs("div",{style:{marginBottom:"0.5em"},children:["Tasks ",r?"enabled ":"disabled ",e.jsx("button",{title:`Toggle tasks to ${r?"disabled ":"enabled "}`,onClick:()=>{u(),c(m=>!m)},children:r?"️🪫":"🔋"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"0.5em"},children:[e.jsx("button",{onClick:()=>{u(),t(null)},children:"Remove all"}),e.jsx("button",{onClick:()=>{u(),o({})},children:"Re-render"})]}),e.jsx("div",{className:"grow",children:e.jsx(E.Provider,{value:g,children:e.jsx(h,{children:e.jsx(i,{},String(s)+"-"+String(r))})})}),e.jsx("div",{style:{marginTop:"0.5em"},children:e.jsx(N,{})})]})]})}function q(){const[n,t]=k.useState(!1),[o,i]=k.useState(!1),[s,a]=k.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[n?"2 levels":"Only 1 level",e.jsx("button",{onClick:()=>t(r=>!r),children:n?"⤴️":"⤵️"})]}),e.jsxs("div",{children:["Timing ",o?"enabled ":"disabled ",e.jsx("button",{onClick:()=>{i(r=>!r)},children:o?"️⌛":"⏳"})]}),e.jsxs("div",{style:{marginBottom:"0.5em"},children:[s?"All tasks":"Some tasks",e.jsx("button",{onClick:()=>a(r=>!r),children:"🔀"})]}),e.jsx("button",{onClick:()=>{console.clear(),d("from React onClick",{tasks:s?"all":!0,timings:o,nestedLogMessage:n?"| from React onClick":void 0})},children:"Trigger from a React onClick"}),e.jsx("button",{ref:r=>{r&&(r.onclick=()=>{console.clear(),d("from HTML onClick",{tasks:s?"all":!0,timings:o,nestedLogMessage:n?"| from HTML onClick":void 0})})},children:"Trigger from a HTML onClick"}),e.jsx("button",{onClick:()=>R(()=>{console.clear(),d("from micro task",{tasks:s?"all":!0,timings:o,nestedLogMessage:n?"| from micro task":void 0})}),children:"Trigger from a micro task"}),e.jsx("button",{onClick:()=>C(()=>{console.clear(),d("from task",{tasks:s?"all":!0,timings:o,nestedLogMessage:n?"| from task":void 0})}),children:"Trigger from a task"}),e.jsx("button",{onClick:()=>C(()=>{console.clear(),d("from user-blocking task",{tasks:s?"all":!0,timings:o,nestedLogMessage:n?"| from user-blocking task":void 0})}),children:"Trigger from a user-blocking task"}),e.jsx("button",{onClick:()=>F(()=>{console.clear(),d("from animation frame",{tasks:s?"all":!0,timings:o,nestedLogMessage:n?"| from animation frame":void 0})}),children:"Trigger from a animation frame"}),e.jsx("button",{onClick:()=>setTimeout(()=>{console.clear(),d("from setTimeout",{tasks:s?"all":!0,timings:o,nestedLogMessage:n?"| from setTimeout":void 0})},50),children:"Trigger from a setTimeout"})]})}function z(){return e.jsx(e.Fragment,{children:e.jsx("button",{onClickCapture:()=>{console.clear(),d("from onClickCapture",{tasks:!0})},onClick:()=>{d("from onClick",{tasks:!0})},children:"Click me"})})}function M(){return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Test how component (re-)renders"}),e.jsx(_,{}),e.jsx("hr",{}),e.jsx("h2",{children:"Test tasks ordering"}),e.jsx(q,{}),e.jsx("hr",{}),e.jsx("h2",{children:"Test event capture / event bubble"}),e.jsx(z,{})]})}const T=!!sessionStorage.getItem("legacyRoot");function G(){return e.jsx(e.Fragment,{children:e.jsxs("button",{onClick:()=>{T?sessionStorage.removeItem("legacyRoot"):sessionStorage.setItem("legacyRoot","true"),window.location.reload()},children:["Switch to ",T?"concurrent":"legacy"]})})}const S=document.getElementById("root");T?W.render(e.jsx(M,{}),S):w(S).render(e.jsx(M,{}));w(document.getElementById("switcher")).render(e.jsx(G,{}));
